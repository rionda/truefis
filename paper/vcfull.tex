The intuition behind the method is the following. Let $\mathcal{B}$ be the
\emph{negative border} of $\TFI(\prob,\Itm,\theta)$, that is the set of itemsets
not in $\TFI(\prob,\Itm,\theta)$ but such that all their proper subsets are in
$\TFI(\prob,\Itm,\theta)$. If we can find an $\varepsilon$ such that $\Ds$ is an
$\varepsilon$-approximation to $(\range(\mathcal{B}),\pi)$ then we have that any
itemset $A\in\mathcal{B}$ has a frequency $f_\Ds(A)$ in $\Ds$ less than
$\hat{\theta}=\theta+\varepsilon$, given that it must be $\tfreq(A)<\theta$. By
the antimonotonicity property of the frequency, the same holds for all itemsets
that are supersets of those in $\mathcal{B}$. Hence, the only itemsets that can
have frequency in $\Ds$ greater or equal to $\hat{\theta}=\theta+\varepsilon$
are those with true frequency at least $\theta$. In the following paragraphs we
show how to compute $\varepsilon$.

\paragraph{Computing a superset of $\mathcal{B}$.} The first step of our
algorithm, which we call \ALG{}, is to compute a superset of $\mathcal{B}$, the
negative border of $\TFI(\prob,\Itm,\theta)$. Let $\delta_1$ and $\delta_2$ be
such that $(1-\delta_1)(1-\delta_2)\ge 1-\delta$. Let $\range(2^\Itm)$ be the
range space of all itemsets. Let $d$ be the upper bound to the empirical
VC-dimension of $\range(2^\Itm)$ on $\Ds$, computed as discussed in
Sect.~\ref{sec:computvcexact}. We can then use~\eqref{eq:evceapproxitemsets}
with $\delta_1$, the bound $d$, and the maximum frequency of an item in $\Ds$ to
compute an $\varepsilon_1$ such that $\Ds$ is, with probability at least
$1-\delta_1$, an $\varepsilon_1$-approximation to $(\range(2^\Itm),\prob)$. Let
now $\mathcal{W}$ be the \emph{negative border} of
$\mathcal{C}_1=\FI(\Ds,\Itm,\theta-\varepsilon_1)$, and let
$\mathcal{G}=\{A\subseteq\Itm ~:~ \theta-\varepsilon_1\le
f_\Ds(A)<\theta+\varepsilon_1\}$, and $\mathcal{F}=\mathcal{G}\cup\mathcal{W}$.

\begin{fact}\label{fact:supersetborder}
	If $\Ds$ is a $\varepsilon_1$-approximation to $(\range(2^\Itm),\prob)$,
	then $\mathcal{B}\subseteq\mathcal{F}$.
\end{fact}

\paragraph{Computing an upper bound to $\EVC(\mathcal{B},\Ds)$.} Now that we
have a superset $\mathcal{F}$ of $\mathcal{B}$, we want to compute an upper
bound to the empirical VC-dimension of $\mathcal{B}$ on $\Ds$. Na\"ively, we
could use any of the algorithms presented in Sect.~\ref{sec:computvc} to compute
an upper bound to $\EVC(\mathcal{F},\Ds)$ and this would be a valid upper bound
to $\EVC(\mathcal{B},\Ds)$ (provided Fact~\ref{fact:supersetborder} holds). The
downside of this line of action is that $\mathcal{F}$ may be much larger than
$\mathcal{B}$ and, even more importantly, that we are choosing to ignore
available information on the structure of $\mathcal{B}$. In particular, we are
choosing to ignore the following.

\begin{fact}
	The negative border of a collection of itemsets is a \emph{maximal
	antichain} on $2^\Itm$
\end{fact}

The collection $\mathcal{F}$ is in general not an antichain, except for
degenerate and unrealistic cases. An upper bound to $\EVC(\mathcal{F},\Ds)$
would be a gross overestimation of $\EVC(\mathcal{B},\Ds)$, hence we would like
to incorporate the fact that $\mathcal{B}$ is a maximal antichain in our
computation of the bound to its empirical VC-dimension.

We can modify \texttt{EVCBoundExact} by including, after having computed the
set $\mathcal{C}_\tau$ (line~\ref{algline:intersectionloopend} in
Alg.~\ref{alg:evcboundexact}), the size $\ell_\tau$ of the largest antichain in
$\mathcal{C}_\tau$, which can be done in time polynomial in $\mathcal{C}_\tau$.
We can then use $\ell_\tau$ as the value for $L[I_\tau]$
(line~\ref{algline:assignmentintersection}). Since $\ell_\tau$ is the size of
the largest antichain in $\mathcal{C}_\tau$, then $\ell_\tau$ is an upper bound
to the number of itemsets from $\mathcal{B}$ that appear in $\tau$. Provided
that $\Ds$ is a $\varepsilon_1$-approximation to $(\range(2^\Itm),\prob)$ (so
that Fact~\ref{fact:supersetborder} holds) the so-modified algorithm, which we
call \texttt{EVCBoundAntichain}, clearly gives an upper-bound to the d-index of
$\mathcal{B}$ on $\Ds$, and therefore to $\EVC(\mathcal{B},\Ds)$. Due to the
additional computation of $\ell_\tau$, this algorithm is slower than
$\texttt{EVCBoundExact}$. It is possible to modify the second part of
\texttt{EVCBoundAntiChain} in the same way as \texttt{EVCBoundExact} was
modified to obtain \texttt{EVCBoundScan}, and obtain a slightly faster
algorithm. Nevertheless, we believe that the need to compute potentially for
each transaction $\tau$ both the set of itemsets of $\mathcal{C}$ in $\tau$ and
additionally the size of the largest antichain on this set, make using
\texttt{EVCBoundAntichain} a bit unpractical, despite being a polynomial time
algorithm.

It is actually for this reason that we developed \texttt{EVCBoundSUKP}, which we
can modify \texttt{EVCBoundSUKP} to solve a slightly modified SUKPs associated
to $\mathcal{F}$ with the \emph{additional constraint} that the optimal solution
(a collection of itemsets) \emph{must be a maximal antichain}. The correctness
follows from the fact that the optimal profit of the so-modified SUKP with
capacity $\ell$ is the maximum number of itemsets forming an antichain in
$\mathcal{F}$ that can be built using a subset of $\ell$ of $U$, so it is an
upper bound to the number of itemsets in $\mathcal{B}$ that can be built on
$\ell$ items of $U$, provided that $\Ds$ is a $\varepsilon_1$-approximation to
$(\range(2^\Itm),\prob)$ (so that Fact~\ref{fact:supersetborder} holds). Hence
Lemma~\ref{lem:sukpevc} carries over and this new algorithm, called
\texttt{EVCBoundSUKPAntiChain} is correct. This algorithm is more practical than
\texttt{EVCBoundAntichain}, striking a more balanced trade-off between
exploiting information about $\mathcal{B}$ and obtaining an upper bound to its
empirical VC-dimension in a reasonable amount of time.

In any case, after having computed an upper bound $d_2$ to
$\EVC(\range(\mathcal{B},\Ds)$, we can use $d_2$ in~\eqref{eq:evceapproxitemsets}
together with $\delta_2$ and the maximum frequency in $\Ds$ of an itemset of
$\mathcal{F}$, to obtain an $\varepsilon_2$ such that, with probability
at least $1-\delta_2$, $\Ds$ is an $\varepsilon_2$-approximation to
$(\range(\mathcal{B}),\prob)$. Let $\hat{\theta}=\theta+\varepsilon_2$. The
following Theorem shows that $\hat{\theta}$ has the desired properties.
Algorithm~\ref{alg:vcfull} presents the pseudocode of our algorithm.

\begin{theorem}\label{lem:vcfull}
With probability at least $1-\delta$, $\FI(\Ds,\Itm,\hat\theta)$ contains no
false positives:
\[
\Pr\left(\FI(\Ds,\Itm,\hat\theta)\subseteq\TFI(\prob,\Itm,\theta)\right)\ge 1-\delta\enspace.\]
\end{theorem}
\begin{proof}
  Consider the two events $\mathsf{E}_1$=``$\Ds$ is an
  $\varepsilon_1$-approximation for $(\range(2^\Itm),\prob)$'' and
  $\mathsf{E}_2$=``$\Ds$ is an $\varepsilon_2$-approximation for
  $(\range(\mathcal{B}),\prob)$''. From the above discussion and the definition
  of $\delta_1$ and $\delta_2$ it follows that the event
  $\mathsf{E}=\mathsf{E}_1\cap\mathsf{E}_1$ occurs with probability at least
  $1-\delta$. Suppose from now on that indeed $\mathsf{E}$ occurs.

  Since $\mathsf{E}_1$ occurs, then Fact~\ref{fact:supersetborder} holds, and
  the value $d_2$ is effectively an upper bound to $\EVC(\range(\mathcal{B},\Ds)$

  Since $\mathsf{E}_2$ also occurs, then for any $A\in\mathcal{B}$ we have
  $|\tfreq(A)-f_\Ds(A)|\le\varepsilon_2$, but given that $\tfreq(A)<\theta$
  because the elements of $\mathcal{B}$ are not TFIs, then we have
  $f_\Ds(A)<\theta+\varepsilon_2$. Because of the antimonotonicity property of
  the frequency and the definition of $\mathcal{B}$, this holds for any itemset
  that is not in $\TFI(\prob,\Itm,\theta)$. Hence, the only itemsets that can
  have a frequency in $\Ds$ at least $\hat{\theta}=\theta+\varepsilon_2$ are the
  TFIs, so $\FI(\Ds,\Itm,\hat{\theta})\subseteq\TFI(\prob,\Itm,\theta)$, which
  concludes our proof.
\end{proof}

\begin{algorithm}[htbp]
  \SetKwInOut{Input}{Input}
  \SetKwInOut{Output}{Output}
  \SetKwComment{Comment}{\quad// }{}
  \SetKwFunction{SolveAntichainSUKP}{solveAntichainSUKP}
   \DontPrintSemicolon
   \Input{Dataset $\Ds$, freq.~threshold $\theta\in(0,1)$, confidence
   $\delta\in(0,1)$}
  \Output{Freq.~threshold $\hat{\theta}$
  s.~t.~$\FI(\Ds,\Itm,\hat{\theta})$ contains only TFIs with prob.~at least
  $1-\delta$.}
  $\delta_1,\delta_2\leftarrow 1-\sqrt{1-\delta}$ \Comment{$\delta_1$ and $\delta_2$ do not need to have the same value}
  $d_1\leftarrow$ upper bound to $\EVC(\range(2^\Itm),\Ds)$  \Comment{as
	discussed in Sect.~\ref{sec:computvcexact}}
  $\varepsilon_1\leftarrow 2c\sqrt{\frac{2d_1\max_{a\in\Itm}f_\Ds(\{a\})}{|\Ds|}}
  + \sqrt{\frac{2\ln\frac{4}{\delta}}{|\Ds|}}$\;
  $\mathcal{C}_1=\FI(\Ds,\Itm,\theta-\varepsilon_1)$\;
  $\mathcal{G}=\{A\subseteq\Itm ~:~ \theta-\varepsilon_1\le
f_\Ds(A)<\theta+\varepsilon_1\}$\;
  $\mathcal{W}\leftarrow$ negative border of $\mathcal{C}_1$\;
  $\mathcal{F}=\mathcal{G}\cup\mathcal{W}$\;
  $d_2\leftarrow$ upper bound to $\EVC(\range(\mathcal{B}),\Ds)$ \Comment{using
	  an ``antichain-aware'' algorithm on $\mathcal{F}$}
  $\varepsilon_2\leftarrow 2c\sqrt{\frac{2d_2\max_{A\in\mathcal{F}}f_\Ds(A)}{|\Ds|}}
  + \sqrt{\frac{2\ln\frac{4}{\delta}}{|\Ds|}}$\;
  \Return{$\theta+\varepsilon_2$}
  \caption{Compute freq.~threshold $\hat{\theta}$
  s.~t.~$\FI(\Ds,\Itm,\hat{\theta})$ contains only TFIs with prob.~at least
  $1-\delta$.}
  \label{alg:vcfull}
\end{algorithm}

% THE FOLLOWING NO LONGER APPLIES BECAUSE WE DON'T COMPUTE THE NON-EMP VC.
%\paragraph{Exploiting additional knowledge about $\prob$.} Our algorithm is
%completely \emph{distribution-free}, i.e., it does not require any assumption
%about the unknown distribution $\prob$. On the other hand, when information
%about $\prob$ is available, our method can exploit it to achieve better
%performances in terms of running time, practicality, and accuracy.  For example,
%in most applications $\prob$ will not generate any transaction longer than some
%known upper bound $\ell\ll|\Itm|$. Consider for example an online marketplace
%like Amazon: it is extremely unlikely (if not humanly impossible) that a single
%customer buys one of each available product. Indeed, given the hundred of
%thousands of items on sale, it is safe to assume that all the transactions will
%contains at most $\ell$ items, for some $\ell\ll|\Itm|$. Other times, like in an
%online survey, it is the nature of the process that limits the number of items
%in a transaction, in this case the number of questions. A different kind of
%information about the generative process may consists in knowing that some
%combination of items may never occur, because ``forbidden'' in some wide sense.
%Other examples are possible. All these pieces of information can be used to
%compute better (i.e., stricter) upper bounds to the VC-dimension
%$\VC(\range(2^\Itm))$. For example, if we know that $\prob$ will never generate
%transactions with more than $\ell$ items, we can safely say that
%$\VC(\range(2^\Itm))\le \ell$, a much stricter bound than $|\Itm|-1$ from
%Corol.~\ref{thm:vcdimubfirst}. This may result in a smaller $\varepsilon_1$, a
%smaller $\varepsilon$, and a smaller $\hat\theta$, which allows to produce more
%TFIs in the output collection. In the experimental evaluation, we show the
%positive impact of including additional information may on the performances of
%our algorithm.
